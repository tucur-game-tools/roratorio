

装備実装

修正ファイル
* item.dat.js  アイテム基本
* itemset.dat.js  セット効果
* card.dat.js  カード、エンチャント効果
* data/mig.enchlist.dat.js  アイテムエンチャント
* timeitem.dat.js  アイテム時限効果
* rndopt.dat.js  ランダムエンチャントのオプション
* rndoptlist.dat.js  ランダムエンチャントのリスト
* rndopttype.dat.js  ランダムエンチャントの種類
* ro4/hmjob.js  補正系
* chara.js  アイテム効果の適応

## アイテム基本

[Index, Kind, Flg, Power(Atk|Def), WPNLv, Slot, 重量, Lv, Name, Ruby, Descriptoin, {id,value}, ..., 0]

装備を追加したら `g_ItemIdArrayByKind` の Kind のところにIDを入れてあげる

|Kind|説明|
|----|----|
|1|短剣|
|2|片手剣|
|3|両手剣|
|4|片手槍|
|7|両手斧|
|8|鈍器|
|9|片手杖|
|10|弓|
|11|カタール|
|12|本|
|13|ナックル|
|14|楽器|
|15|鞭|
|16|風魔手裏剣|
|17|ハンドガン|
|18|ライフル|
|19|ショットガン|
|20|ガトリングガン|
|21|グレネードガン|
|50|上段|
|51|中断|
|52|下段|
|60|鎧|
|62|肩にかけるもの|
|63|靴|
|64|アクセ|
|65|アクセ（１）|
|100|セット効果|

ウェポンLVに `X00000` を足すとランダムエンチャント対象


|ID|説明|
|----|----|
|1|Str+|
|2|Agi+|
|3|Vit+|
|4|Int+|
|5|Dex+|
|6|Luk+|
|7|Allステータス+|
|9|Free+|
|10|Cri+|
|11|完全回避|
|12|Aspd+%|
|13|MaxHP+|
|14|MaxSP+|
|15|MaxHP+%|
|16|MaxSP+%|
|17|Atk+|
|18|Def+|
|19|Mdef+|
|25|遠距離物理攻撃で与えるダメージ|
|27|物理攻撃時、小型のモンスターに与えるダメージ|
|28|物理攻撃時、中型のモンスターに与えるダメージ|
|29|物理攻撃時、大型のモンスターに与えるダメージ|
|32|物理攻撃時、動物形のモンスターに与えるダメージ|
|37|物理攻撃時、人間形のモンスターに与えるダメージ|
|43|物理攻撃時、火属性のモンスターに与えるダメージ|
|60|無属性耐性|
|65|毒属性耐性|
|66|聖属性耐性|
|67|闇属性耐性|
|68|念属性耐性|
|70|クリティカル攻撃で与えるダメージ|
|73|詠唱時間-|
|74|ディレイ-|
|77|Boss耐性|
|79|一般耐性|
|80|物理ダメージ+%|
|86|必中攻撃+%|
|88|MATK+|
|89|魔法ダメージ+%|
|91|ヒール系スキルを使用した時の回復量|
|97|魔法攻撃時、小型のモンスターに与えるダメージ|
|98|魔法攻撃時、中型のモンスターに与えるダメージ|
|99|魔法攻撃時、大型のモンスターに与えるダメージ|
|100|Matk+|
|102|消費SP-%|
|111|不死形に対してクリティカル+|
|151|スタン耐性|
|152|凍結耐性|
|159|石化耐性|
|194|破損しない (1)|
|195|両手杖 (1)|
|198|水属性鎧|
|199|習得スキル設定対象|
|217|Allステータス+?|
|219|指定IDの効果を無効|
|220|習得スキル設定 (usableskill.dat.jsのInsertSkill参照)|
|230|Pow+|
|231|Sta+|
|232|Wis+|
|233|Spl+|
|234|Con+|
|235|Crt+|
|236|All特性ステータス+|
|243|P耐性|
|255|Mres+|
|261|物理攻撃時、全ての種族のモンスターに与えるダメージ|
|262|物理攻撃時、全ての属性のモンスターに与えるダメージ|
|266|魔法攻撃時、全ての種族のモンスターに与えるダメージ|
|268|魔法攻撃時、一般モンスターに与えるダメージ|
|269|魔法攻撃時、全ての属性のモンスターに与えるダメージ|
|293|Def %無視||
|298|Mdef %無視|
|340|無属性魔法攻撃で与えるダメージ|
|341|水属性魔法攻撃で与えるダメージ|
|342|地属性魔法攻撃で与えるダメージ|
|343|火属性魔法攻撃で与えるダメージ|
|344|風属性魔法攻撃で与えるダメージ|
|345|毒属性魔法攻撃で与えるダメージ|
|346|聖属性魔法攻撃で与えるダメージ|
|347|闇属性魔法攻撃で与えるダメージ|
|348|念属性魔法攻撃で与えるダメージ|

`5000` 数値を足す<br>
スキルIDの威力が％アップする<br>

`7000` 数値を足す<br>
スキルIDの詠唱時間を％減らす<br>

`11000` 数値を足す<br>
スキルIDの固定詠唱を％減らす<br>

`13000` 数値を足す<br>
スキルIDの固定詠唱をミリ秒減らす（マイナス指定で増やす）<br>

`19000` 数値を足す<br>
スキルIDのCTをミリ秒減らす<br>

`23000` 数値を足す<br>
スキルIDの消費SPを減らす<br>

`5800000005000` 数値を足す<br>
ソーサラーが装備時、スキルIDの威力が％アップする<br>

`5800000007000` 数値を足す<br>
ソーサラーが装備時、スキルIDの詠唱時間が％現象する<br>

`X0000000000000` 数値を足す<br>
BaseLv Xごとに能力がアップする<br>

`X0000000005000` 数値を足す<br>
BaseLv Xごとにスキルの威力がX％アップする<br>

`1000000000000000` 数値を足す<br>
BaseLvが170以上の時にアップする<br>

精錬値が１上がるたびにに対応するには `100000` 数値を足す<br>
例：精錬値が1上がる度に追加で念属性攻撃で受けるダメージ - 2%<br>
```
100068,2,
```

精錬値がX以上の場合に対応するには `X000000` 数値を足す<br>
例：精錬値が７以上の場合に13P耐性<br>
```
7000243,13,
```

精錬値がX上がるたびにに対応するには `X05000` 数値を足す<br>
例：精錬値が1上がる度に追加で朔月脚で与えるダメージ 5%<br>
```
105954,5,
```

精錬値がX以上の場合に対応するには `X005000` 数値を足す<br>
例：精錬値が７以上の場合に朔月脚で与えるダメージ 10%<br>
```
7005954,10,
```

＊＊出現するモンスターに与えるダメージを実装は `head.js` に書く（２箇所）<br>

ApplyMagicalSpecializeMonsterMod20211014SubSpecializeMap<br>
ApplyPhysicalSpecializeMonster<br>
```
//--------------------------------
// アルデバラン時計塔地下 未知の空間特化
//--------------------------------
if(NumSearch(mobData[0], MonsterGroupObj[MONSTER_GROUP_ID_CLOCK_01]) == 1){
    if ((cardCount = CardNumSearch(CARD_ID_X_2930)) > 0) {
        w += 30 * cardCount;
    }
}
```

モンスターグループは `monstergroup.dat.js` に書く<br>


## セット効果

[SetEquipID, EquipID, EquipID, ...]<br>
SetEquipIDのデータにセット時の効果を入れる<br>
EquipIDの部分がマイナスだと card.dat.js のエンチャント効果をみる<br>

例：フェイスオブイグドラシル<br>
[マジェスティオブイグドラシル]と共に装備時、追加で全ての基本ステータス + 10、移動速度増加<br>
```
// 4485 = フェイスオブイグドラシル
// 4947 = マジェスティオブイグドラシル
// 4948 = 移動速度増加
w_SE = [
  ...
  [4948,4947,4485],
  ...
]

// セット効果の関連付け [ItemID] = [w_SE.index]
ItemIdToSetIdMap[4485] = [2360];
CardIdToSetIdMap[] = [];
```
## カード、エンチャント効果

[CardID, Kind, Name, Description, {id, value}, ..., 0]

|Kind|説明|
|1|武器|
|2|兜|
|3|縦|
|4|鎧|
|5|肩にかけるもの|
|6|靴|
|7|アクセ|
|99|エンチャント|
|100|セット効果|

## スペシャルエンチャント

エンチャント設定は `g_constDataManager.enchListDataManager.sourceArray` に追加する<br>

エンチャント情報
```
// 精錬がある
[
    EnchID, ?, ?, ?, [[Name, Eiji]],
    [], 
    [
        [
            [?,[?[EquipID,...]]]
        ],,
        [
            [
                [?, [?, [SlotIndex]]],,
                [
                    [
                        // [59,6] => 精錬値６以上？
                        [?,[?,?],[?,?]],,
                        [
                            [
                                [?,[?,[CardID,...]]],,
                                []
                            ]
                        ]
                    ]
                ]
            ]
        ]
]

// 精錬がない
[
    EnchID, ?, ?, ?, [[Name, Eiji]],
    [], 
    [
        [
            [?,[?[EquipID,...]]]
        ],,
        [
            [
                [?, [?, [SlotIndex]]],,
                [
                    [
                        [?,[?,[CardID,...]]],,
                        []
                    ]
                ]
            ]
        ]
]
```

EquipIDと関連付け<br>
`g_constDataManager.enchListDataManager.reverseResolveArrayItemId` にEquipIDのIndexと同じポイントに [EnchID] を入れる


## アイテム時限効果

[ID, Name, Description, [[Kind?,ID]],{id, value},...,0]

|Kind?|説明|
|----|----|
|1|Equip|
|2|Card|

## ランダムエンチャントのオプション

[ID, SpID, Min, Max, Step, SpecialFlag]

## ランダムエンチャントのリスト

[ID, [0, RndID, ...]]

## ランダムエンチャントのリスト

[ID, [Slot1, Slot2, Slot3, Slot4, Slot5]]

## 補正系

一部効果はハードコードされている

アイテムの条件式が入ってる<br>
`function ApplySpecModify`

```
// 「星座の印象（創造）の純粋なステータスによる効果」
if ((itemCount = EquipNumSearch(ITEM_ID_X_5007)) > 0) {
    if (g_pureStatus[MIG_PARAM_ID_CRT] >= 100) {
        spVal += 50;
    }
}
```

## アイテム効果の適応

一部効果はハードコードされている

```
//----------------------------------------------------------------
// 「りんりんニャンカーベル」の、スキル習得による効果
//----------------------------------------------------------------
if ((itemCount = EquipNumSearch(ITEM_ID_X_5034)) > 0) {
    val += 3 * LearnedSkillSearch(SKILL_ID_NODOWO_NARASU);
}
```

## 拡張対応

超越の対象精錬先

|right|
|left|
|top|
|shield|
|body|
|shoulder|
|shoes|
